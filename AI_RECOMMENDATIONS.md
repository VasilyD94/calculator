# ü§ñ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏ –ò–ò

> **–ü—Ä–∏–Ω—Ü–∏–ø:** –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ A/B —Ç–µ—Å—Ç—ã

---

## üìä –û–±–∑–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –§–ê–ó–ê        ‚îÇ  –ß–¢–û –î–ï–õ–ê–ï–ú                     ‚îÇ  –ö–û–ì–î–ê        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  MVP         ‚îÇ  –ë–µ–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π               ‚îÇ  –ú–µ—Å—è—Ü 1-2    ‚îÇ
‚îÇ  –§–∞–∑–∞ 2      ‚îÇ  –ü—Ä–æ—Å—Ç—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (if/else) ‚îÇ  –ú–µ—Å—è—Ü 3-6    ‚îÇ
‚îÇ              ‚îÇ  + A/B —Ç–µ—Å—Ç + –æ–ø—Ä–æ—Å             ‚îÇ               ‚îÇ
‚îÇ  –§–∞–∑–∞ 3      ‚îÇ  –ò–ò –∞–≤—Ç–æ-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏           ‚îÇ  –ú–µ—Å—è—Ü 7+     ‚îÇ
‚îÇ              ‚îÇ  (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ A/B —É—Å–ø–µ—à–µ–Ω)      ‚îÇ               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ –§–∞–∑–∞ 1 (MVP): –ë–µ–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

**–¶–µ–ª—å:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç, –Ω–∞–±—Ä–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã.

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
- –§–æ–∫—É—Å –Ω–∞ –±–∞–∑–æ–≤—ã—Ö –∫–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞—Ö (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª, —à–∫–∞–ª—ã, PDF)
- –ù–∞–±–∏—Ä–∞–µ–º –∞—É–¥–∏—Ç–æ—Ä–∏—é
- –ò–∑—É—á–∞–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ú–µ—Ç—Ä–∏–∫–µ
- –ù—É–ª–µ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ù–ï –¥–µ–ª–∞–µ–º** ‚Äî —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –Ω—É–∂–Ω—ã –ª–∏ –æ–Ω–∏ –≤–æ–æ–±—â–µ.

---

## üß™ –§–∞–∑–∞ 2: –ü—Ä–æ—Å—Ç—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ + A/B —Ç–µ—Å—Ç

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–∏–ø–æ—Ç–µ–∑—É ‚Äî —É–ª—É—á—à–∞—é—Ç –ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫–∏?

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

–ó–∞—Ä–∞–Ω–µ–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ —É—Å–ª–æ–≤–∏—è–º (if/else).
–ë–µ–∑ API, –±–µ–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤, –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º.

```
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä]
              ‚Üì
[–ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç]
              ‚Üì
[–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è]
              ‚Üì
[–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏–∑ –∑–∞–≥–æ—Ç–æ–≤–æ–∫]
```

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∏–∫–∏ –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –∫–∞–ª–æ—Ä–∏–π

```typescript
// lib/recommendations/calories.ts

interface CalorieData {
  gender: 'male' | 'female'
  age: number
  weight: number
  height: number
  bmi: number
  activity: string
  goal: 'lose' | 'maintain' | 'gain'
  tdee: number
  targetCalories: number
}

interface Recommendation {
  emoji: string
  title: string
  text: string
  priority: 'high' | 'medium' | 'low'
}

export function getCalorieRecommendations(data: CalorieData): Recommendation[] {
  const recommendations: Recommendation[] = []
  
  // === –ü–û –ò–ú–¢ ===
  
  if (data.bmi < 18.5) {
    recommendations.push({
      emoji: '‚ö†Ô∏è',
      title: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –≤–µ—Å',
      text: `–ü—Ä–∏ –ò–ú–¢ ${data.bmi.toFixed(1)} —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É–≤–µ–ª–∏—á–∏—Ç—å –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å –Ω–∞ 300-500 –∫–∫–∞–ª –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–∏–ª–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è –Ω–∞–±–æ—Ä–∞ –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã.`,
      priority: 'high'
    })
  }
  
  if (data.bmi >= 25 && data.bmi < 30) {
    recommendations.push({
      emoji: 'üìä',
      title: '–í–∞—à–∞ —Å–∏—Ç—É–∞—Ü–∏—è',
      text: `–ò–ú–¢ ${data.bmi.toFixed(1)} ‚Äî –∏–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å, –Ω–æ –Ω–µ –æ–∂–∏—Ä–µ–Ω–∏–µ. –í —ç—Ç–æ–π –∑–æ–Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏ –¥–∞—é—Ç –±—ã—Å—Ç—Ä—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–µ–∑ –∂—ë—Å—Ç–∫–∏—Ö –¥–∏–µ—Ç.`,
      priority: 'medium'
    })
  }
  
  if (data.bmi >= 30) {
    recommendations.push({
      emoji: '‚ö†Ô∏è',
      title: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è',
      text: '–ü—Ä–∏ –ò–ú–¢ –≤—ã—à–µ 30 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –≤—Ä–∞—á–æ–º –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –¥–∏–µ—Ç—ã. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ç–µ–º–ø ‚Äî –Ω–µ –±–æ–ª–µ–µ 0.5-1 –∫–≥ –≤ –Ω–µ–¥–µ–ª—é.',
      priority: 'high'
    })
  }
  
  // === –ü–û –í–û–ó–†–ê–°–¢–£ ===
  
  if (data.age >= 30 && data.age < 40) {
    recommendations.push({
      emoji: '‚ö°',
      title: '–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –≤–æ–∑—Ä–∞—Å—Ç–∞',
      text: '–ü–æ—Å–ª–µ 30 –ª–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º –∑–∞–º–µ–¥–ª—è–µ—Ç—Å—è –Ω–∞ 3-5% –∫–∞–∂–¥—ã–µ 10 –ª–µ—Ç. –í–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –º—ã—à–µ—á–Ω—É—é –º–∞—Å—Å—É ‚Äî –æ–Ω–∞ "—Å–∂–∏–≥–∞–µ—Ç" –∫–∞–ª–æ—Ä–∏–∏ –≤ –ø–æ–∫–æ–µ.',
      priority: 'low'
    })
  }
  
  if (data.age >= 40 && data.age < 50) {
    recommendations.push({
      emoji: '‚ö°',
      title: '–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –≤–æ–∑—Ä–∞—Å—Ç–∞',
      text: '–ü–æ—Å–ª–µ 40 –º–µ—Ç–∞–±–æ–ª–∏–∑–º –∑–∞–º–µ–¥–ª–∏–ª—Å—è –Ω–∞ 5-10%. –î–æ–±–∞–≤—å—Ç–µ —Å–∏–ª–æ–≤—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –º—ã—à—Ü.',
      priority: 'medium'
    })
  }
  
  if (data.age >= 50) {
    recommendations.push({
      emoji: '‚ö°',
      title: '–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –≤–æ–∑—Ä–∞—Å—Ç–∞',
      text: '–ü–æ—Å–ª–µ 50 –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–µ–Ω –±–µ–ª–æ–∫ (1.2-1.5 –≥ –Ω–∞ –∫–≥ –≤–µ—Å–∞) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã. –¢–∞–∫–∂–µ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –≤–∏—Ç–∞–º–∏–Ω–æ–º D.',
      priority: 'medium'
    })
  }
  
  // === –ü–û –ê–ö–¢–ò–í–ù–û–°–¢–ò ===
  
  if (data.activity === 'sedentary' && data.goal === 'lose') {
    recommendations.push({
      emoji: 'üö∂',
      title: '–ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±',
      text: '–ü—Ä–∏ —Å–∏–¥—è—á–µ–º –æ–±—Ä–∞–∑–µ –∂–∏–∑–Ω–∏ –¥–æ–±–∞–≤—å—Ç–µ 30 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã –≤ –¥–µ–Ω—å ‚Äî —ç—Ç–æ +150-200 –∫–∫–∞–ª —Ä–∞—Å—Ö–æ–¥–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è.',
      priority: 'high'
    })
  }
  
  // === –ü–û –¶–ï–õ–ò ===
  
  if (data.goal === 'lose') {
    const deficit = data.tdee - data.targetCalories
    
    if (deficit > 700) {
      recommendations.push({
        emoji: '‚ö†Ô∏è',
        title: '–ë–æ–ª—å—à–æ–π –¥–µ—Ñ–∏—Ü–∏—Ç',
        text: `–î–µ—Ñ–∏—Ü–∏—Ç ${deficit} –∫–∫–∞–ª –∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –º—ã—à—Ü –∏ —Å—Ä—ã–≤–∞–º. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º 300-500 –∫–∫–∞–ª –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.`,
        priority: 'high'
      })
    }
    
    const minCalories = data.gender === 'male' ? 1500 : 1200
    if (data.targetCalories < minCalories) {
      recommendations.push({
        emoji: 'üö®',
        title: '–°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–æ',
        text: `–ö–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å –Ω–∏–∂–µ ${minCalories} –∫–∫–∞–ª –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –º–µ—Ç–∞–±–æ–ª–∏–∑–º. –õ—É—á—à–µ –¥–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, —á–µ–º —Å–∏–ª—å–Ω–µ–µ —É—Ä–µ–∑–∞—Ç—å –µ–¥—É.`,
        priority: 'high'
      })
    }
  }
  
  if (data.goal === 'gain') {
    recommendations.push({
      emoji: 'üí™',
      title: '–î–ª—è –Ω–∞–±–æ—Ä–∞ –º–∞—Å—Å—ã',
      text: `–ß—Ç–æ–±—ã –Ω–∞–±–∏—Ä–∞—Ç—å –º—ã—à—Ü—ã, –∞ –Ω–µ –∂–∏—Ä: 1.6-2 –≥ –±–µ–ª–∫–∞ –Ω–∞ –∫–≥ –≤–µ—Å–∞, —Å–∏–ª–æ–≤—ã–µ 3-4 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é, –ø—Ä–æ—Ñ–∏—Ü–∏—Ç 300-500 –∫–∫–∞–ª.`,
      priority: 'high'
    })
  }
  
  // === –ë–ï–õ–û–ö ===
  
  const minProtein = Math.round(data.weight * 1.2)
  const optProtein = Math.round(data.weight * 1.6)
  
  recommendations.push({
    emoji: 'ü•©',
    title: '–ù–æ—Ä–º–∞ –±–µ–ª–∫–∞',
    text: `–ü—Ä–∏ –≤–µ—Å–µ ${data.weight} –∫–≥ –º–∏–Ω–∏–º—É–º –±–µ–ª–∫–∞: ${minProtein} –≥/–¥–µ–Ω—å. –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º—ã—à—Ü: ${optProtein} –≥/–¥–µ–Ω—å.`,
    priority: 'medium'
  })
  
  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ø-4
  const priorityOrder = { high: 0, medium: 1, low: 2 }
  return recommendations
    .sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority])
    .slice(0, 4)
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ò–ú–¢

```typescript
// lib/recommendations/bmi.ts

export function getBMIRecommendations(data: BMIData): Recommendation[] {
  const recommendations: Recommendation[] = []
  
  const idealMin = Math.round(18.5 * (data.height / 100) ** 2)
  const idealMax = Math.round(24.9 * (data.height / 100) ** 2)
  
  recommendations.push({
    emoji: 'üéØ',
    title: '–ò–¥–µ–∞–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω',
    text: `–î–ª—è —Ä–æ—Å—Ç–∞ ${data.height} —Å–º –∑–¥–æ—Ä–æ–≤—ã–π –≤–µ—Å: ${idealMin}-${idealMax} –∫–≥. ${
      data.weight > idealMax 
        ? `–¶–µ–ª—å ‚Äî ${idealMax} –∫–≥, –º–∏–Ω—É—Å ${data.weight - idealMax} –∫–≥.`
        : data.weight < idealMin
        ? `–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞–±—Ä–∞—Ç—å ${idealMin - data.weight} –∫–≥.`
        : '–í—ã –≤ –∑–¥–æ—Ä–æ–≤–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ!'
    }`,
    priority: 'high'
  })
  
  const waistLimit = data.gender === 'male' ? 94 : 80
  recommendations.push({
    emoji: 'üìè',
    title: '–û–±—Ö–≤–∞—Ç —Ç–∞–ª–∏–∏',
    text: `–ò–ú–¢ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∂–∏—Ä–∞. –ò–∑–º–µ—Ä—å—Ç–µ —Ç–∞–ª–∏—é ‚Äî ${data.gender === 'male' ? '–¥–ª—è –º—É–∂—á–∏–Ω' : '–¥–ª—è –∂–µ–Ω—â–∏–Ω'} –Ω–æ—Ä–º–∞ –¥–æ ${waistLimit} —Å–º.`,
    priority: 'medium'
  })
  
  return recommendations
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏

```typescript
// lib/recommendations/pregnancy.ts

export function getPregnancyRecommendations(data: PregnancyData): Recommendation[] {
  const recommendations: Recommendation[] = []
  
  // –ü–æ —Ç—Ä–∏–º–µ—Å—Ç—Ä–∞–º
  if (data.trimester === 1) {
    recommendations.push({
      emoji: 'üíä',
      title: '–ü–µ—Ä–≤—ã–π —Ç—Ä–∏–º–µ—Å—Ç—Ä',
      text: '–§–æ–ª–∏–µ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞ —Å–µ–π—á–∞—Å (400-800 –º–∫–≥/–¥–µ–Ω—å). –û–Ω–∞ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –¥–µ—Ñ–µ–∫—Ç–æ–≤ –Ω–µ—Ä–≤–Ω–æ–π —Ç—Ä—É–±–∫–∏.',
      priority: 'high'
    })
  }
  
  if (data.trimester === 2) {
    recommendations.push({
      emoji: 'üéâ',
      title: '–ó–æ–ª–æ—Ç–æ–π –ø–µ—Ä–∏–æ–¥',
      text: '–í—Ç–æ—Ä–æ–π —Ç—Ä–∏–º–µ—Å—Ç—Ä ‚Äî —Å–∞–º—ã–π –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π! –î–æ–±–∞–≤—å—Ç–µ –≤ —Ä–∞—Ü–∏–æ–Ω –∂–µ–ª–µ–∑–æ –∏ –∫–∞–ª—å—Ü–∏–π. –ù–æ—Ä–º–∞ –Ω–∞–±–æ—Ä–∞ –≤–µ—Å–∞: +1-1.5 –∫–≥ –≤ –º–µ—Å—è—Ü.',
      priority: 'medium'
    })
  }
  
  if (data.trimester === 3) {
    recommendations.push({
      emoji: 'üõèÔ∏è',
      title: '–§–∏–Ω–∏—à–Ω–∞—è –ø—Ä—è–º–∞—è',
      text: '–ë–æ–ª—å—à–µ –æ—Ç–¥—ã—Ö–∞–π—Ç–µ, —Å–ø–∏—Ç–µ –Ω–∞ –ª–µ–≤–æ–º –±–æ–∫—É. –°–æ–±–µ—Ä–∏—Ç–µ —Å—É–º–∫—É –≤ —Ä–æ–¥–¥–æ–º –∫ 36 –Ω–µ–¥–µ–ª–µ. –°–ª–µ–¥–∏—Ç–µ –∑–∞ —à–µ–≤–µ–ª–µ–Ω–∏—è–º–∏ ‚Äî –Ω–æ—Ä–º–∞ 10+ –≤ –¥–µ–Ω—å.',
      priority: 'high'
    })
  }
  
  // –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è
  if (data.currentWeek >= 10 && data.currentWeek < 14) {
    recommendations.push({
      emoji: 'üè•',
      title: '–°–∫–æ—Ä–æ –ø–µ—Ä–≤—ã–π —Å–∫—Ä–∏–Ω–∏–Ω–≥',
      text: `–ù–∞ 11-14 –Ω–µ–¥–µ–ª–µ ‚Äî –ø–µ—Ä–≤—ã–π —Å–∫—Ä–∏–Ω–∏–Ω–≥ (–£–ó–ò + –∞–Ω–∞–ª–∏–∑ –∫—Ä–æ–≤–∏). ${data.currentWeek < 11 ? `–û—Å—Ç–∞–ª–æ—Å—å ${11 - data.currentWeek} –Ω–µ–¥.` : '–°–∞–º–æ–µ –≤—Ä–µ–º—è!'}`,
      priority: 'high'
    })
  }
  
  if (data.currentWeek >= 18 && data.currentWeek < 22) {
    recommendations.push({
      emoji: 'üè•',
      title: '–í—Ç–æ—Ä–æ–π —Å–∫—Ä–∏–Ω–∏–Ω–≥',
      text: '–ù–∞ 18-21 –Ω–µ–¥–µ–ª–µ ‚Äî –≤—Ç–æ—Ä–æ–π —Å–∫—Ä–∏–Ω–∏–Ω–≥. –ú–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –ø–æ–ª –º–∞–ª—ã—à–∞!',
      priority: 'high'
    })
  }
  
  if (data.currentWeek >= 28 && data.currentWeek < 32) {
    recommendations.push({
      emoji: 'üìã',
      title: '–î–µ–∫—Ä–µ—Ç–Ω—ã–π –æ—Ç–ø—É—Å–∫',
      text: `–° 30 –Ω–µ–¥–µ–ª–∏ –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –¥–µ–∫—Ä–µ—Ç. ${data.currentWeek < 30 ? `–û—Å—Ç–∞–ª–æ—Å—å ${30 - data.currentWeek} –Ω–µ–¥.` : '–£–∂–µ –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–ª—è—Ç—å!'}`,
      priority: 'medium'
    })
  }
  
  return recommendations.slice(0, 3)
}
```

### UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

```tsx
// components/features/SimpleRecommendations.tsx
"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Lightbulb } from "lucide-react"

interface Recommendation {
  emoji: string
  title: string
  text: string
  priority: 'high' | 'medium' | 'low'
}

interface Props {
  recommendations: Recommendation[]
}

export function SimpleRecommendations({ recommendations }: Props) {
  if (recommendations.length === 0) return null
  
  return (
    <Card>
      <CardHeader className="pb-3">
        <CardTitle className="flex items-center gap-2 text-lg">
          <Lightbulb className="w-5 h-5 text-yellow-500" />
          –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-3">
        {recommendations.map((rec, i) => (
          <div 
            key={i}
            className={`p-3 rounded-lg border ${
              rec.priority === 'high' 
                ? 'bg-primary/5 border-primary/20' 
                : 'bg-muted/50'
            }`}
          >
            <div className="flex gap-2 mb-1">
              <span>{rec.emoji}</span>
              <span className="font-medium text-sm">{rec.title}</span>
            </div>
            <p className="text-sm text-muted-foreground pl-6">
              {rec.text}
            </p>
          </div>
        ))}
      </CardContent>
    </Card>
  )
}
```

---

### A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```tsx
// components/features/ABTest.tsx
"use client"

import { useEffect, useState } from "react"

interface ABTestProps {
  testName: string
  variantA: React.ReactNode  // –ö–æ–Ω—Ç—Ä–æ–ª—å (–±–µ–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π)
  variantB: React.ReactNode  // –¢–µ—Å—Ç (—Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏)
}

export function ABTest({ testName, variantA, variantB }: ABTestProps) {
  const [variant, setVariant] = useState<'A' | 'B' | null>(null)
  
  useEffect(() => {
    const key = `ab_${testName}`
    let v = localStorage.getItem(key) as 'A' | 'B' | null
    
    if (!v) {
      v = Math.random() < 0.5 ? 'A' : 'B'
      localStorage.setItem(key, v)
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫—É
      if ((window as any).ym) {
        (window as any).ym(METRIKA_ID, 'reachGoal', `ab_assigned_${testName}`, { variant: v })
      }
    }
    
    setVariant(v)
  }, [testName])
  
  if (!variant) return null
  return variant === 'A' ? variantA : variantB
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ:
<ABTest
  testName="recommendations_v1"
  variantA={null}  // –ë–µ–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
  variantB={<SimpleRecommendations recommendations={getCalorieRecommendations(data)} />}
/>
```

### –û–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```tsx
// components/features/FeedbackSurvey.tsx
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"

export function FeedbackSurvey({ calculatorName }: { calculatorName: string }) {
  const [visible, setVisible] = useState(false)
  const [answered, setAnswered] = useState(false)
  
  useEffect(() => {
    const key = `survey_${calculatorName}`
    if (!localStorage.getItem(key)) {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 5 —Å–µ–∫
      setTimeout(() => setVisible(true), 5000)
    }
  }, [calculatorName])
  
  const handleAnswer = (answer: string) => {
    localStorage.setItem(`survey_${calculatorName}`, answer)
    setAnswered(true)
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
    if ((window as any).ym) {
      (window as any).ym(METRIKA_ID, 'reachGoal', 'survey_answer', {
        calculator: calculatorName,
        answer,
      })
    }
    
    setTimeout(() => setVisible(false), 2000)
  }
  
  if (!visible) return null
  
  return (
    <Card className="border-dashed">
      <CardContent className="pt-4">
        {answered ? (
          <p className="text-sm text-center text-muted-foreground">–°–ø–∞—Å–∏–±–æ! üôè</p>
        ) : (
          <>
            <p className="text-sm mb-3">
              –•–æ—Ç–µ–ª–∏ –±—ã –ø–æ–ª—É—á–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç –ò–ò?
            </p>
            <div className="flex gap-2">
              <Button size="sm" onClick={() => handleAnswer('yes')}>
                üëç –î–∞
              </Button>
              <Button size="sm" variant="outline" onClick={() => handleAnswer('maybe')}>
                –í–æ–∑–º–æ–∂–Ω–æ
              </Button>
              <Button size="sm" variant="ghost" onClick={() => handleAnswer('no')}>
                –ù–µ—Ç
              </Button>
            </div>
          </>
        )}
      </CardContent>
    </Card>
  )
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –§–∞–∑–µ 3

```typescript
// –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ò–ò —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:

const SUCCESS_CRITERIA = {
  // –í—Ä–µ–º—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã—Ä–æ—Å–ª–æ –Ω–∞ 20%+
  timeOnPageIncrease: 1.2,
  
  // –û—Ç–∫–∞–∑—ã —Å–Ω–∏–∑–∏–ª–∏—Å—å –Ω–∞ 10%+
  bounceRateDecrease: 0.9,
  
  // 60%+ –æ—Ç–≤–µ—Ç–∏–ª–∏ "–¥–∞" –∏–ª–∏ "–≤–æ–∑–º–æ–∂–Ω–æ" –≤ –æ–ø—Ä–æ—Å–µ
  surveyPositiveRate: 0.6,
  
  // –ú–∏–Ω–∏–º—É–º 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∫–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
  minSampleSize: 1000,
}
```

---

## ü§ñ –§–∞–∑–∞ 3: –ò–ò –∞–≤—Ç–æ-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ A/B —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω!**

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

```
–í–ê–ñ–ù–û: –≠—Ç–æ –ù–ï —á–∞—Ç!

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –≤–≤–æ–¥–∏—Ç.
–ò–ò –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–Ω–∞–ª–∏–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞.

[–ó–∞–ø–æ–ª–Ω—è–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä] ‚Üí [–†–µ–∑—É–ª—å—Ç–∞—Ç] ‚Üí [ü§ñ –ü–æ–∫–∞–∑–∞—Ç—å –ò–ò-–∞–Ω–∞–ª–∏–∑]
                                                    ‚Üì
                                        [–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç]
```

### –ü—Ä–æ–º—Ç—ã –¥–ª—è –ò–ò

```typescript
// lib/ai/prompts.ts

export const AI_PROMPTS = {
  
  calories: (data: CalorieData) => `–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–∏—Ç–∞–Ω–∏—é. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

–î–ê–ù–ù–´–ï:
- –ü–æ–ª: ${data.gender === 'male' ? '–º—É–∂—á–∏–Ω–∞' : '–∂–µ–Ω—â–∏–Ω–∞'}
- –í–æ–∑—Ä–∞—Å—Ç: ${data.age} –ª–µ—Ç
- –†–æ—Å—Ç: ${data.height} —Å–º, –í–µ—Å: ${data.weight} –∫–≥
- –ò–ú–¢: ${data.bmi.toFixed(1)}
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${data.activity}
- –¶–µ–ª—å: ${data.goal === 'lose' ? '–ø–æ—Ö—É–¥–µ–Ω–∏–µ' : data.goal === 'gain' ? '–Ω–∞–±–æ—Ä' : '–ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ'}
- BMR: ${data.bmr} –∫–∫–∞–ª, TDEE: ${data.tdee} –∫–∫–∞–ª
- –î–ª—è —Ü–µ–ª–∏: ${data.targetCalories} –∫–∫–∞–ª

–§–û–†–ú–ê–¢ (—Å—Ç—Ä–æ–≥–æ):
üìä –í–∞—à–∞ —Å–∏—Ç—É–∞—Ü–∏—è
[2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å —Ü–∏—Ñ—Ä–∞–º–∏]

‚ö° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å
[1 —Ñ–∞–∫—Ç –ø—Ä–æ –≤–æ–∑—Ä–∞—Å—Ç/–ø–æ–ª/–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å]

üéØ –ü–ª–∞–Ω
‚Ä¢ [—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å —Ü–∏—Ñ—Ä–æ–π]
‚Ä¢ [—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å —Ü–∏—Ñ—Ä–æ–π]
‚Ä¢ [—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å —Ü–∏—Ñ—Ä–æ–π]

‚ö†Ô∏è –í–∞–∂–Ω–æ
[1 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ]

–û–±—Ä–∞—â–∞–π—Å—è –Ω–∞ "–≤—ã". –î–ª–∏–Ω–∞: 150-200 —Å–ª–æ–≤. –ë–µ–∑ markdown.`,

  bmi: (data: BMIData) => `–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∑–¥–æ—Ä–æ–≤—å—é. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ò–ú–¢.

–î–ê–ù–ù–´–ï:
- –ü–æ–ª: ${data.gender === 'male' ? '–º—É–∂—á–∏–Ω–∞' : '–∂–µ–Ω—â–∏–Ω–∞'}
- –í–æ–∑—Ä–∞—Å—Ç: ${data.age}, –†–æ—Å—Ç: ${data.height} —Å–º, –í–µ—Å: ${data.weight} –∫–≥
- –ò–ú–¢: ${data.bmi.toFixed(1)}, –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${data.category}
- –ò–¥–µ–∞–ª—å–Ω—ã–π –≤–µ—Å: ${data.idealRange.min}-${data.idealRange.max} –∫–≥

–§–û–†–ú–ê–¢:
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî [—á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ò–ú–¢]
üë• –°—Ä–∞–≤–Ω–µ–Ω–∏–µ ‚Äî [–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ä–µ–¥–Ω–µ–≥–æ]
üéØ –¶–µ–ª—å ‚Äî [–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å]
üí° –ù—é–∞–Ω—Å ‚Äî [–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ò–ú–¢]

–î–ª–∏–Ω–∞: 120-150 —Å–ª–æ–≤.`,

  pregnancy: (data: PregnancyData) => `–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

–î–ê–ù–ù–´–ï:
- –ù–µ–¥–µ–ª—è: ${data.currentWeek}, –¢—Ä–∏–º–µ—Å—Ç—Ä: ${data.trimester}
- –ü–î–†: ${data.dueDate}, –î–Ω–µ–π –¥–æ —Ä–æ–¥–æ–≤: ${data.daysLeft}

–§–û–†–ú–ê–¢:
üéâ [–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –Ω–µ–¥–µ–ª–µ–π]
üìÖ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ‚Äî [2-3 —Ñ–∞–∫—Ç–∞ –æ –º–∞–ª—ã—à–µ]
‚úÖ –ü–æ–∑–∞–¥–∏ ‚Äî [–ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã]
üìã –í–ø–µ—Ä–µ–¥–∏ ‚Äî [–±–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è]
üí° –°–æ–≤–µ—Ç ‚Äî [1 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è]

–¢–æ–Ω: —Ç—ë–ø–ª—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π. –ù–ï –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã. 150-180 —Å–ª–æ–≤.`,

  whatif: (data: WhatIfData) => `–¢—ã ‚Äî –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π —Ç—Ä–µ–Ω–µ—Ä.

–î–ê–ù–ù–´–ï:
- –°–µ–π—á–∞—Å: ${data.currentWeight} –∫–≥ ‚Üí –¶–µ–ª—å: ${data.targetWeight} –∫–≥
- –°–±—Ä–æ—Å–∏—Ç—å: ${data.weightToLose} –∫–≥
- –î–µ—Ñ–∏—Ü–∏—Ç: ${data.deficit} –∫–∫–∞–ª/–¥–µ–Ω—å
- –°—Ä–æ–∫: ${data.weeksNeeded} –Ω–µ–¥–µ–ª—å
- –î–∞—Ç–∞ —Ü–µ–ª–∏: ${data.targetDate}
- –¢–µ–º–ø: ${data.weeklyLoss} –∫–≥/–Ω–µ–¥

–§–û–†–ú–ê–¢:
üéØ –¶–µ–ª—å ‚Äî [—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å]
üìà –ü—É—Ç—å ‚Äî [—á–µ—Ä–µ–∑ –º–µ—Å—è—Ü X –∫–≥, —á–µ—Ä–µ–∑ –¥–≤–∞ Y]
üí™ –ü–æ–º–æ–∂–µ—Ç ‚Äî [2-3 —Å–æ–≤–µ—Ç–∞]
‚ö†Ô∏è –°–ª–æ–∂–Ω–æ—Å—Ç–∏ ‚Äî [–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Ç—è–∂–µ–ª–æ]

–ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π —Ç–æ–Ω. 130-160 —Å–ª–æ–≤.`,

}
```

### API Route

```typescript
// app/api/ai/analyze/route.ts

import { NextRequest, NextResponse } from 'next/server'
import { kv } from '@vercel/kv'
import { AI_PROMPTS } from '@/lib/ai/prompts'

// –ö–ª—é—á –∫—ç—à–∞ —Å "–±–∞–∫–µ—Ç–∞–º–∏" –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
function getCacheKey(type: string, data: any): string {
  const age = Math.floor((data.age || 0) / 5) * 5
  const bmi = Math.floor((data.bmi || 0) / 2) * 2
  const week = data.currentWeek || 0
  
  return `ai:${type}:${data.gender}:${age}:${bmi}:${data.activity}:${data.goal}:${week}`
}

export async function POST(req: NextRequest) {
  const { type, data } = await req.json()
  
  if (!type || !data || !AI_PROMPTS[type as keyof typeof AI_PROMPTS]) {
    return NextResponse.json({ error: 'Invalid' }, { status: 400 })
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
  const cacheKey = getCacheKey(type, data)
  const cached = await kv.get(cacheKey)
  
  if (cached) {
    return NextResponse.json({ analysis: cached, cached: true })
  }
  
  // –ó–∞–ø—Ä–æ—Å –∫ OpenAI
  const prompt = AI_PROMPTS[type as keyof typeof AI_PROMPTS](data)
  
  const response = await fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${process.env.OPENAI_API_KEY}`,
    },
    body: JSON.stringify({
      model: 'gpt-4o-mini',  // –î–µ—à—ë–≤–∞—è –º–æ–¥–µ–ª—å
      messages: [{ role: 'user', content: prompt }],
      max_tokens: 400,
      temperature: 0.7,
    }),
  })
  
  const result = await response.json()
  const analysis = result.choices[0]?.message?.content || ''
  
  // –ö—ç—à–∏—Ä—É–µ–º –Ω–∞ 24 —á–∞—Å–∞
  await kv.set(cacheKey, analysis, { ex: 86400 })
  
  return NextResponse.json({ analysis, cached: false })
}
```

### UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ò–ò-–∞–Ω–∞–ª–∏–∑–∞

```tsx
// components/features/AIAnalysis.tsx
"use client"

import { useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Sparkles, Loader2, RefreshCw } from "lucide-react"

interface AIAnalysisProps {
  type: 'calories' | 'bmi' | 'pregnancy' | 'whatif'
  data: Record<string, any>
}

export function AIAnalysis({ type, data }: AIAnalysisProps) {
  const [analysis, setAnalysis] = useState<string | null>(null)
  const [loading, setLoading] = useState(false)
  const [visible, setVisible] = useState(false)

  const fetch Analysis = async () => {
    setLoading(true)
    setVisible(true)
    
    try {
      const res = await fetch('/api/ai/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ type, data }),
      })
      const result = await res.json()
      setAnalysis(result.analysis)
    } catch {
      setAnalysis('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–Ω–∞–ª–∏–∑.')
    } finally {
      setLoading(false)
    }
  }

  if (!visible) {
    return (
      <Button 
        onClick={fetchAnalysis}
        variant="outline"
        className="w-full gap-2 h-12 border-dashed"
      >
        <Sparkles className="w-5 h-5 text-primary" />
        –ü–æ–∫–∞–∑–∞—Ç—å –ò–ò-–∞–Ω–∞–ª–∏–∑
      </Button>
    )
  }

  return (
    <Card className="border-primary/20 bg-primary/5">
      <CardHeader className="pb-3">
        <CardTitle className="flex items-center justify-between text-lg">
          <span className="flex items-center gap-2">
            <Sparkles className="w-5 h-5 text-primary" />
            –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
          </span>
          {analysis && (
            <Button variant="ghost" size="sm" onClick={fetchAnalysis}>
              <RefreshCw className="w-4 h-4" />
            </Button>
          )}
        </CardTitle>
      </CardHeader>
      <CardContent>
        {loading ? (
          <div className="flex items-center justify-center py-8 gap-2">
            <Loader2 className="w-6 h-6 animate-spin text-primary" />
            <span className="text-muted-foreground">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...</span>
          </div>
        ) : (
          <div className="space-y-3">
            {analysis?.split('\n\n').map((p, i) => (
              <p key={i} className="text-sm leading-relaxed">{p}</p>
            ))}
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

---

## üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞ –ò–ò

### –°—Ç–æ–∏–º–æ—Å—Ç—å —Å GPT-4o-mini

```
–ü—Ä–æ–º—Ç: ~400 —Ç–æ–∫–µ–Ω–æ–≤ √ó $0.15/1M = $0.00006
–û—Ç–≤–µ—Ç: ~300 —Ç–æ–∫–µ–Ω–æ–≤ √ó $0.60/1M = $0.00018
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò—Ç–æ–≥–æ –∑–∞ 1 –∑–∞–ø—Ä–æ—Å: $0.00024 ‚âà 0.024 ‚ÇΩ
```

### –†–∞—Å—á—ë—Ç –ø–æ —Ç—Ä–∞—Ñ–∏–∫—É

| –¢—Ä–∞—Ñ–∏–∫/–¥–µ–Ω—å | –ò—Å–ø–æ–ª—å–∑—É—é—Ç –ò–ò (30%) | –ö—ç—à (90%) | –†–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ | –°—Ç–æ–∏–º–æ—Å—Ç—å/–º–µ—Å |
|-------------|---------------------|-----------|-------------------|---------------|
| 500 | 150 | 135 | 15 | ~15 ‚ÇΩ |
| 2,000 | 600 | 540 | 60 | ~45 ‚ÇΩ |
| 5,000 | 1,500 | 1,350 | 150 | ~110 ‚ÇΩ |
| 10,000 | 3,000 | 2,700 | 300 | ~220 ‚ÇΩ |

**–í—ã–≤–æ–¥:** –ë–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–∞!

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ê—Å–ø–µ–∫—Ç | –ë–µ–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π | –ü—Ä–æ—Å—Ç—ã–µ (–§–∞–∑–∞ 2) | –ò–ò (–§–∞–∑–∞ 3) |
|--------|------------------|------------------|-------------|
| –°—Ç–æ–∏–º–æ—Å—Ç—å/–º–µ—Å | 0 ‚ÇΩ | 0 ‚ÇΩ | 50-200 ‚ÇΩ |
| –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è | ‚ùå | –°—Ä–µ–¥–Ω—è—è | ‚úÖ –í—ã—Å–æ–∫–∞—è |
| –ö–æ–Ω—Ç—Ä–æ–ª—å | ‚Äî | ‚úÖ –ü–æ–ª–Ω—ã–π | –ß–∞—Å—Ç–∏—á–Ω—ã–π |
| –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | ‚úÖ –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å | ‚Äî | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω—è—è |

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 2 (–ú–µ—Å—è—Ü 3-6)
```
‚ñ° –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –∫–∞–ª–æ—Ä–∏–π
‚ñ° –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ò–ú–¢
‚ñ° –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏
‚ñ° –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç SimpleRecommendations
‚ñ° –ù–∞—Å—Ç—Ä–æ–∏—Ç—å A/B —Ç–µ—Å—Ç
‚ñ° –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ä–æ—Å
‚ñ° –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–ª–∏ –≤ –ú–µ—Ç—Ä–∏–∫–µ
‚ñ° –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ 2-4 –Ω–µ–¥–µ–ª–∏
‚ñ° –°–æ–±—Ä–∞—Ç—å –º–∏–Ω–∏–º—É–º 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç
‚ñ° –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

### –§–∞–∑–∞ 3 (–ú–µ—Å—è—Ü 7+, –µ—Å–ª–∏ A/B —É—Å–ø–µ—à–µ–Ω)
```
‚ñ° –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á OpenAI
‚ñ° –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Vercel KV –∏–ª–∏ Redis –¥–ª—è –∫—ç—à–∞
‚ñ° –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤
‚ñ° –°–æ–∑–¥–∞—Ç—å API route /api/ai/analyze
‚ñ° –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç AIAnalysis
‚ñ° –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 5% —Ç—Ä–∞—Ñ–∏–∫–∞
‚ñ° –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏ –≤—Å—ë –û–ö
```

---

*–í–µ—Ä—Å–∏—è 1.0 | –Ø–Ω–≤–∞—Ä—å 2025*
